<!DOCTYPE html>
<html lang="en">

<head>
  <!-- This module is part of an AI based system, utilizing both the Reactive Machine and the Limited Memory types, under a Supervised Learning model.  -->
  <title>ProValet HOME</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <style>
    html,
    body,
    h1,
    h2,
    h3,
    h4 {
      font-family: Geneva, Verdana, sans-serif;
    }

    body {
      overflow: auto;
      background-color: #ccc;
      box-sizing: border-box;
    }

    .valet-container {
      display: flex;
      padding-top: 160px;
      padding-bottom: 40px;
      overflow: hidden;
    }

    #Garage {
      position: relative;
      margin: auto;
    }
  </style>
</head>

<body>
  <!-- App's Top (locked) Panel -->
  <div class="w3-top w3-container" style="background-color:#2B569A; height: 90px;">
    <div class="w3-row">
      <div class="w3-col w3-container w3-display-left" style="width:180px;">
        <img src="PRO Valet logo v1.jpg" alt="Pro Valet" />
      </div>
      <div class="w3-col w3-container w3-display-position" style="top:47px;left:230px;">

        <!-- Nav Buttons -->
        <div class="w3-bar w3-large w3-text-light-grey">
          <a href="#" class="w3-button w3-bar-item">Operations</a>
          <a href="javascript:alert('OPTION NOT AVAILABLE'); void(0);"
            class="w3-button w3-bar-item w3-hide-small">Customers</a>
          <a href="javascript:alert('OPTION NOT AVAILABLE'); void(0);"
            class="w3-button w3-bar-item w3-hide-medium w3-hide-small">Search</a>
          <a href="javascript:alert('OPTION NOT AVAILABLE'); void(0);"
            class="w3-button w3-bar-item w3-hide-medium w3-hide-small">Calendar</a>
          <a href="javascript:alert('OPTION NOT AVAILABLE'); void(0);"
            class="w3-button w3-bar-item w3-hide-medium w3-hide-small">Personnel</a>
          <a href="javascript:alert('OPTION NOT AVAILABLE'); void(0);"
            class="w3-button w3-bar-item w3-hide-medium w3-hide-small">Admin</a>
          <a href="javascript:void(0)" class="w3-bar-item w3-button w3-right w3-hide-large"
            onclick="myFunction()">&#9776;</a>
        </div>
        <div id="nav" class="w3-bar-block w3-hide w3-hide-large w3-text-light-grey"
          style="background-color:#2B569A; border-style: solid; border-color: black;">
          <a href="#" class="w3-bar-item w3-button">Customers</a>
          <a href="#" class="w3-bar-item w3-button">Search</a>
          <a href="#" class="w3-bar-item w3-button">Calendar</a>
          <a href="#" class="w3-bar-item w3-button">Personnel</a>
          <a href="#" class="w3-bar-item w3-button">Admin</a>
        </div>

      </div>

      <div class="w3-rest w3-container w3-display-position" style="top:1px;right:8px;">
        <p id="result" class="w3-text-white w3-padding-small w3-border w3-border-grey"
          style="background-color: #556fbb;">
          <!-- Garage Image UI Initializer and Server Status (SSE) is sent here -->
          <!-- background-color: #b7005b; *** TODO USE THIS BG color IF FAILURE -->
          PAGE INIT
        </p>
      </div>

    </div>
  </div>

  <!-- App's Garage Layout Panel -->
  <div class="valet-container">
    <div id="Garage" ondrop="drop(event)" ondragover="allowDrop(event)">
      <img src="Ford GF v3.png" alt="Ford GF" id="BgImg" />
    </div>
  </div>
  <!-- END OF App's Garage Layout Panel -->

  <img src="Car.png" ondragstart="dragStart(event)" ondrag="dragging(event)" draggable="true" id="DragTarget"
    style="position: fixed; top: 100px; left: 20px" />

  <script>
    const socket = new WebSocket('ws://localhost:12345');

    socket.addEventListener('open', (event) => {
      console.log('Connected to server');
    });

    socket.addEventListener('message', (event) => {
      console.log(`Received message: ${event.data}`);
    });

    socket.addEventListener('close', (event) => {
      console.log('Disconnected from server');
    });

    socket.addEventListener('error', (event) => {
      console.error(`Error: ${event}`);
    });

    function sendMessage(message) {
      socket.send(message);
    }
  </script>

  <script>
    const BgImgEl = document.getElementById("BgImg");
    const GarageEl = document.getElementById("Garage");
    const DragTargetEl = document.getElementById("DragTarget");

    function dragStart(event) {
      event.dataTransfer.setData("ID", event.target.id);
    }

    function dragging(event) {
    }

    function allowDrop(event) {
      event.preventDefault();
    }

    function drop(event) {
      event.preventDefault();
      if (isDropOnCar(event)) return;
      if (!isValidPosition(event)) return;
      const id = event.dataTransfer.getData("ID");
      let el = document.getElementById(id);
      if (isDropFirst(id)) {
        generateNewDragItem();
        el.id += new Date().getTime();
      }
      el.style.position = "absolute";
      el.style.left = event.offsetX + "px";
      el.style.top = event.offsetY + "px";
      GarageEl.appendChild(el);
      sendMessage(JSON.stringify({ x: event.offsetX, y: event.offsetY }))
    }

    function isDropOnCar(event) {
      return event.target.id.includes("DragTarget");
    }

    function isDropFirst(id) {
      return id === "DragTarget";
    }

    function generateNewDragItem() {
      const el = document.createElement(DragTargetEl.tagName);
      el.src = DragTargetEl.src;
      el.ondragstart = DragTargetEl.ondragstart;
      el.ondrag = DragTargetEl.ondrag;
      el.ondrag = DragTargetEl.ondrag;
      el.draggable = DragTargetEl.draggable;
      el.id = "DragTarget";
      el.style.position = "fixed";
      el.style.top = "100px";
      el.style.left = "20px";
      document.body.appendChild(el)
    }

    function isValidPosition(event) {
      const item = { x: 335, y: 65, width: 35, height: 115, empty: true }
      if (
        event.offsetX > item.x &&
        event.offsetX < item.x + item.width &&
        event.offsetY > item.y &&
        event.offsetY < item.y + item.height &&
        item.empty
      ) return true
      return false
    }
  </script>


</body>

</html>